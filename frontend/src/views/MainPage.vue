<template>
  <div class="landing-wrapper">
    <section ref="hero" class="section hero">
      <h1 class="hero-title">ê¸ˆìœµìƒí™œì„ ë³´ë‹¤ ë” í¸ë¦¬í•˜ê²Œ</h1>
      <p class="hero-subtitle">ì˜ˆì ê¸ˆ ë¹„êµ, ì¶”ì²œë°›ê¸°, í˜„ë¬¼ ì‹œì„¸ í™•ì¸, ì»¤ë®¤ë‹ˆí‹°ê¹Œì§€ í•œ ë²ˆì—</p>
      <button class="cta">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
    </section>

    <!-- ì˜ˆì ê¸ˆ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    <section ref="products" class="section products">
      <div class="products-text">
        <h2>ë‹¤ì–‘í•œ ê¸ˆìœµ ìƒí’ˆì„ í•œ ëˆˆì— ë¹„êµí•´ìš”.</h2>
        <p>ì˜ˆì ê¸ˆ ìƒí’ˆì„ ëª¨ì•„ ë³¼ ìˆ˜ ìˆì–´ìš”.</p>
      </div>

      <div class="cards-section">
        <div class="cards-row">
          <div class="card" v-for="deposit in topDeposits" :key="'deposit-' + deposit.id">
            <h3>{{ deposit.fin_prdt_nm }}</h3>
            <p>{{ deposit.kor_co_nm }}</p>
            <p>ê¸ˆë¦¬: {{ deposit.max_intr_rate2 }}%</p>
          </div>
        </div>

        <div class="cards-row">
          <div class="card" v-for="saving in topSavings" :key="'saving-' + saving.id">
            <h3>{{ saving.fin_prdt_nm }}</h3>
            <p>{{ saving.kor_co_nm }}</p>
            <p>ê¸ˆë¦¬: {{ saving.max_intr_rate2 }}%</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ë§ì¶¤ ì¶”ì²œ -->
    <section ref="recommend" class="section recommend">
      <RouterLink :to="{ name: 'RecommendView' }">
        <button class="cta">ì¶”ì²œë°›ê¸°</button>
      </RouterLink>
      <h2>ë‚˜ì—ê²Œ ë§ëŠ” ì˜ˆì ê¸ˆì„ ì¶”ì²œ ë°›ì•„ìš”.</h2>
      <p>ëª‡ ê°€ì§€ ì§ˆë¬¸ì—ë§Œ ë‹µí•˜ë©´ ë!</p>
    </section>

    <!-- ì»¤ë®¤ë‹ˆí‹° -->
    <section ref="community" class="section community">
      <h2>í˜¼ìë³´ë‹¤ í•¨ê»˜ ë” ë˜‘ë˜‘í•œ ê¸ˆìœµ ìƒí™œ!</h2>
      <div class="community-container">
        <div class="community-card">
          <div class="community-title">ì•ˆë…•í•˜ì„¸ìš”</div>
          <div class="community-tags">
            <span class="community-tag">#ììœ ê²Œì‹œíŒ</span>
          </div>
          <div class="community-extra">ëš±ì¸ë°ìš”</div>
        </div>
        <div class="community-card">
          <div class="community-title">ë“±ì´Œì¹¼êµ­ìˆ˜ë¥¼ ë“œì…” ë³´ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”?</div>
          <div class="community-tags">
            <span class="community-tag">#ì ˆì•½ ê¿€íŒ</span>
          </div>
          <div class="community-extra">ì™€ ì§„ì§œ ë„ˆë¬´ ë§›ìˆë˜ë°ìš”??</div>
        </div>
        <div class="community-card">
          <div class="community-title">ë¼ˆì°œì´ ë¨¹ê³ ì‹¶ì€ í•˜ë£¨ë„¤ìš”..</div>
          <div class="community-tags">
            <span class="community-tag">#ì ê¸ˆ í›„ê¸°</span>
          </div>
          <div class="community-extra">
            ë¼ˆì°œì´ ë„ˆë¬´ ì¸ê¸°ê°€ ë§ì•„ì„œ ì•„ì‰½ìŠµë‹ˆë‹¤<br />
            ì–¸ì œì¯¤ ë¨¹ì–´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?
          </div>
        </div>
      </div>
    </section>

    <!-- ê¸ˆ/ì€ ì‹œì„¸ -->
    <section ref="market" class="section market">
      <h2>ì‹¤ì‹œê°„ ê¸ˆ/ì€ ì‹œì„¸ ë¹„êµ</h2>
      <div class="graph">ğŸ“ˆ ì‹¤ì‹œê°„ ê·¸ë˜í”„ ìë¦¬</div>
    </section>

    <!-- ì§€ë„ -->
    <section ref="map" class="section map">
      <h2>ì§€ê¸ˆ ë‚˜ì™€ ê°€ê¹Œìš´ ì€í–‰ì„ ê²€ìƒ‰í•´ìš”.</h2>
      <div class="map-container">ì§€ë„ ì»´í¬ë„ŒíŠ¸</div>
    </section>

    <!-- CTA -->
    <section class="section final-cta">
      <h2>ì§€ê¸ˆ, ë‹¹ì‹ ì˜ ê¸ˆìœµìƒí™œì„ ë°”ê¿”ë³´ì„¸ìš”</h2>
      <div class="cta-buttons">
        <button>íšŒì›ê°€ì… í•˜ëŸ¬ê°€ê¸°</button>
      </div>
    </section>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import axios from 'axios'
import gsap from 'gsap'
import ScrollTrigger from 'gsap/ScrollTrigger'
import { RouterLink } from 'vue-router'

gsap.registerPlugin(ScrollTrigger)

const hero = ref(null)
const products = ref(null)
const recommend = ref(null)
const community = ref(null)
const market = ref(null)
const map = ref(null)
const API_URL = 'http://127.0.0.1:8000'
const topDeposits = ref([])
const topSavings = ref([])

onMounted(async () => {
  // 1. ì¸ê¸° ì˜ˆê¸ˆ/ì ê¸ˆ ë¶ˆëŸ¬ì˜¤ê¸°
  try {
    const [depositRes, savingRes] = await Promise.all([
      axios.get(`${API_URL}/finlife/deposit/`, { params: { ordering: '-joined_count' } }),
      axios.get(`${API_URL}/finlife/saving/`, { params: { ordering: '-joined_count' } }),
    ])

    topDeposits.value = depositRes.data.slice(0, 3)
    topSavings.value = savingRes.data.slice(0, 3)
  } catch (err) {
    console.error('ì¸ê¸° ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err)
  }

  // 2. gsap
  const sections = [products, recommend, community, market, map]

  sections.forEach((sectionRef, i) => {
    gsap.fromTo(
      sectionRef.value,
      { opacity: 0, y: 100, scale: 0.95 },
      {
        scrollTrigger: {
          trigger: sectionRef.value,
          start: 'top 80%',
          toggleActions: 'play none none none',
        },
        opacity: 1,
        y: 0,
        scale: 1,
        duration: 0.8,
        ease: 'power3.out',
        delay: i * 0.15,
      },
    )
  })
})
</script>

<style scoped>
html,
body {
  scroll-behavior: smooth;
  margin: 0;
  padding: 0;
  font-family: 'Pretendard', sans-serif;
  background: #f9fafb;
}

.section {
  min-height: 100vh;
  padding: 6rem 2rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  scroll-snap-align: start;
}

.hero {
  background: linear-gradient(to bottom, #e0f2fe, #ffffff);
  background-attachment: fixed;
  text-align: center;
}
.hero-title {
  font-weight: 600;
  font-size: 4rem;
  color: #191f28;
}
.hero-subtitle {
  font-size: 2rem;
  color: #4e5968;
}

.products {
  display: flex;
  flex-direction: row;
  background: #fef3c7;
}
.products-text {
  flex-direction: column;
}
.recommend {
  display: flex;
  flex-direction: row;
  background: #bae6fd;
}
.community {
  background: #d1fae5;
}
.market {
  background: #f3e8ff;
}
.map {
  background: #fff7ed;
}

.final-cta {
  background-color: #2563eb;
  color: white;
  text-align: center;
}

.cards.products {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  justify-content: center;
  margin-top: 2rem;
}
.card,
.graph,
.map-container {
  background-color: #e5e7eb;
  padding: 2rem;
  border-radius: 0.75rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transition: transform 0.3s ease;
}

.cta,
.cta-buttons button {
  margin-top: 2rem;
  padding: 0.8rem 1.8rem;
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s ease;
}
.cta:hover,
.cta-buttons button:hover {
  background-color: #1e40af;
}

.cta-buttons {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 1.5rem;
}

.tags {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  flex-wrap: wrap;
}
.tags span {
  background: white;
  padding: 0.4rem 1rem;
  border-radius: 9999px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #2563eb;
}

.community-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: flex-start;
}

.community-card {
  width: 280px;
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
  background-color: #ffffff;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 1.2rem;
  font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
}

.community-title {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
  line-height: 1.4;
  margin-bottom: 0.8rem;
}

.community-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.3rem;
  font-size: 0.75rem;
  color: #9ca3af;
  margin-bottom: 1rem;
}

.community-tag {
  background-color: #f3f4f6;
  padding: 0.2rem 0.6rem;
  border-radius: 9999px;
}

.community-extra {
  font-size: 0.85rem;
  line-height: 1.4;
  color: #374151;
  background-color: #f9fafb;
  padding: 0.8rem;
  border-radius: 12px;
  margin-top: auto;
}

.cards-section {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin-top: 2rem;
  width: 100%;
  align-items: center;
}

.cards-row {
  display: flex;
  gap: 2rem;
  justify-content: center;
  flex-wrap: wrap;
}

.card {
  flex: 0 0 calc(33.33% - 2rem);
  max-width: 300px;
}
</style>
