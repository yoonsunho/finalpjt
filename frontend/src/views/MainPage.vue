<template>
  <div class="landing-wrapper">
    <section ref="hero" class="section hero">
      <h1 class="hero-title">ê¸ˆìœµìƒí™œì„ ë³´ë‹¤ ë” í¸ë¦¬í•˜ê²Œ</h1>
      <p class="hero-subtitle">ë‹¹ì‹ ì˜ ê¸ˆìœµ,<br />ì„ í˜¸í•˜ëŠ” ê²ƒì„ ì§€ì›í•´ ë“œë¦½ë‹ˆë‹¤.</p>
      <button class="cta">ì§€ê¸ˆ ì‹œì‘í•˜ê¸°</button>
    </section>

    <section ref="products" class="section products">
      <div class="products-text">
        <br />
        <br />
        <h2>ë‹¤ì–‘í•œ ê¸ˆìœµ ìƒí’ˆì„ í•œ ëˆˆì— ë¹„êµí•´ìš”.</h2>
        <!-- <br /> -->
        <p>ì—¬ëŸ¬ ì€í–‰ì˜ ì˜ˆì ê¸ˆ ìƒí’ˆì„ ëª¨ì•„ ë³¼ ìˆ˜ ìˆì–´ìš”.</p>
      </div>

      <div class="carousel-row-wrapper">
        <h3 class="carousel-row-title">ì˜ˆê¸ˆ TOP10</h3>
        <div ref="depositCarousel" class="carousel-row-track">
          <div class="carousel-card" v-for="deposit in topDeposits" :key="'deposit-' + deposit.id">
            <div class="carousel-card-header">
              <img
                class="bankimage"
                v-if="getBankImage(deposit.kor_co_nm)"
                :src="getBankImage(deposit.kor_co_nm)"
                alt="ì€í–‰ ë¡œê³ "
              />
            </div>
            <div class="carousel-card-content">
              <h3>{{ deposit.fin_prdt_nm }}</h3>
              <h4>{{ deposit.kor_co_nm }}</h4>
              <h5>ê¸ˆë¦¬: {{ deposit.max_intr_rate2 }}%</h5>
            </div>
          </div>

          <div class="carousel-card" v-for="deposit in topDeposits" :key="'deposit-' + deposit.id">
            <div class="carousel-card-header">
              <img
                class="bankimage"
                v-if="getBankImage(deposit.kor_co_nm)"
                :src="getBankImage(deposit.kor_co_nm)"
                alt="ì€í–‰ ë¡œê³ "
              />
            </div>
            <div class="carousel-card-content">
              <h3>{{ deposit.fin_prdt_nm }}</h3>
              <h4>{{ deposit.kor_co_nm }}</h4>
              <h5>ê¸ˆë¦¬: {{ deposit.max_intr_rate2 }}%</h5>
            </div>
          </div>
        </div>
        <div class="gradient-overlay gradient-overlay-left"></div>
        <div class="gradient-overlay gradient-overlay-right"></div>
      </div>

      <div class="carousel-row-wrapper">
        <h3 class="carousel-row-title">ì ê¸ˆ TOP10</h3>
        <div ref="savingCarousel" class="carousel-row-track">
          <div class="carousel-card" v-for="saving in topSavings" :key="'saving-' + saving.id">
            <div class="carousel-card-header">
              <img
                class="bankimage"
                v-if="getBankImage(saving.kor_co_nm)"
                :src="getBankImage(saving.kor_co_nm)"
                alt="ì€í–‰ ë¡œê³ "
              />
            </div>
            <div class="carousel-card-content">
              <h3>{{ saving.fin_prdt_nm }}</h3>
              <h4>{{ saving.kor_co_nm }}</h4>
              <h5>ê¸ˆë¦¬: {{ saving.max_intr_rate2 }}%</h5>
            </div>
          </div>
          <div class="carousel-card" v-for="saving in topSavings" :key="'saving-' + saving.id">
            <div class="carousel-card-header">
              <img
                class="bankimage"
                v-if="getBankImage(saving.kor_co_nm)"
                :src="getBankImage(saving.kor_co_nm)"
                alt="ì€í–‰ ë¡œê³ "
              />
            </div>
            <div class="carousel-card-content">
              <h3>{{ saving.fin_prdt_nm }}</h3>
              <h4>{{ saving.kor_co_nm }}</h4>
              <h5>ê¸ˆë¦¬: {{ saving.max_intr_rate2 }}%</h5>
            </div>
          </div>
        </div>
        <div class="gradient-overlay gradient-overlay-left"></div>
        <div class="gradient-overlay gradient-overlay-right"></div>
      </div>
    </section>

    <!-- ë§ì¶¤ ì¶”ì²œ -->
    <section ref="recommend" class="section recommend">
      <h2>ë‚˜ì—ê²Œ ë§ëŠ” ì˜ˆì ê¸ˆì„ ì¶”ì²œ ë°›ì•„ìš”.</h2>
      <p>ëª‡ ê°€ì§€ ì§ˆë¬¸ì—ë§Œ ë‹µí•˜ë©´ ë!</p>
      <RouterLink :to="{ name: 'RecommendView' }">
        <button class="cta">ì¶”ì²œë°›ê¸°</button>
      </RouterLink>
    </section>

    <!-- ì»¤ë®¤ë‹ˆí‹° -->
    <section ref="community" class="section community">
      <h2>í˜¼ìë³´ë‹¤ í•¨ê»˜ ë” ë˜‘ë˜‘í•œ ê¸ˆìœµ ìƒí™œ!</h2>
      <div class="community-container">
        <div class="community-card">
          <div class="community-title">ì•ˆë…•í•˜ì„¸ìš”</div>
          <div class="community-tags">
            <span class="community-tag">#ììœ ê²Œì‹œíŒ</span>
          </div>
          <div class="community-extra">ëš±ì¸ë°ìš”</div>
        </div>
        <div class="community-card">
          <div class="community-title">ë“±ì´Œì¹¼êµ­ìˆ˜ë¥¼ ë“œì…” ë³´ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”?</div>
          <div class="community-tags">
            <span class="community-tag">#ì ˆì•½ ê¿€íŒ</span>
          </div>
          <div class="community-extra">ì™€ ì§„ì§œ ë„ˆë¬´ ë§›ìˆë˜ë°ìš”??</div>
        </div>
        <div class="community-card">
          <div class="community-title">ë¼ˆì°œì´ ë¨¹ê³ ì‹¶ì€ í•˜ë£¨ë„¤ìš”..</div>
          <div class="community-tags">
            <span class="community-tag">#ì ê¸ˆ í›„ê¸°</span>
          </div>
          <div class="community-extra">
            ë¼ˆì°œì´ ë„ˆë¬´ ì¸ê¸°ê°€ ë§ì•„ì„œ ì•„ì‰½ìŠµë‹ˆë‹¤<br />
            ì–¸ì œì¯¤ ë¨¹ì–´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?
          </div>
        </div>
      </div>
    </section>

    <!-- ê¸ˆ/ì€ ì‹œì„¸ -->
    <section ref="market" class="section market">
      <h2>ì‹¤ì‹œê°„ ê¸ˆ/ì€ ì‹œì„¸ ë¹„êµ</h2>
      <div class="graph">ğŸ“ˆ ì‹¤ì‹œê°„ ê·¸ë˜í”„ ìë¦¬</div>
    </section>

    <!-- ì§€ë„ -->
    <section ref="map" class="section map">
      <h2>ì§€ê¸ˆ ë‚˜ì™€ ê°€ê¹Œìš´ ì€í–‰ì„ ê²€ìƒ‰í•´ìš”.</h2>
      <div class="map-container">ì§€ë„ ì»´í¬ë„ŒíŠ¸</div>
    </section>

    <!-- CTA -->
    <section class="section final-cta">
      <h2>ì§€ê¸ˆ, ë‹¹ì‹ ì˜ ê¸ˆìœµìƒí™œì„ ë°”ê¿”ë³´ì„¸ìš”</h2>
      <div class="cta-buttons">
        <button>íšŒì›ê°€ì… í•˜ëŸ¬ê°€ê¸°</button>
      </div>
    </section>
  </div>
</template>

<script setup>
const bankImages = import.meta.glob('@/assets/images/*', { eager: true, import: 'default' })
import { ref, onMounted } from 'vue'
import axios from 'axios'
import gsap from 'gsap'
import ScrollTrigger from 'gsap/ScrollTrigger'
import { RouterLink } from 'vue-router'

gsap.registerPlugin(ScrollTrigger)

const hero = ref(null)
const products = ref(null)
const recommend = ref(null)
const community = ref(null)
const market = ref(null)
const map = ref(null)
const API_URL = 'http://127.0.0.1:8000'
const topDeposits = ref([])
const topSavings = ref([])

const depositCarousel = ref(null)
const savingCarousel = ref(null)

onMounted(async () => {
  // 1. ì¸ê¸° ì˜ˆê¸ˆ/ì ê¸ˆ ë¶ˆëŸ¬ì˜¤ê¸°
  try {
    const [depositRes, savingRes] = await Promise.all([
      axios.get(`${API_URL}/finlife/deposit/`, { params: { ordering: '-joined_count' } }),
      axios.get(`${API_URL}/finlife/saving/`, { params: { ordering: '-joined_count' } }),
    ])

    topDeposits.value = depositRes.data.slice(0, 10)
    topSavings.value = savingRes.data.slice(0, 10)
  } catch (err) {
    console.error('ì¸ê¸° ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err)
  }

  const sections = [products, recommend, community, market, map]

  sections.forEach((sectionRef, i) => {
    gsap.fromTo(
      sectionRef.value,
      { opacity: 0, y: 100, scale: 0.95 },
      {
        scrollTrigger: {
          trigger: sectionRef.value,
          start: 'top 80%',
          toggleActions: 'play none none none',
        },
        opacity: 1,
        y: 0,
        scale: 1,
        duration: 0.8,
        ease: 'power3.out',
        delay: i * 0.15,
      },
    )
    gsap.to(depositCarousel.value, {
      x: `-50%`,
      ease: 'none',
      duration: 60,
      repeat: -1,
      modifiers: {
        x: gsap.utils.unitize((x) => parseFloat(x) % depositCarousel.value.scrollWidth),
      },
    })

    gsap.to(savingCarousel.value, {
      x: `-50%`,
      ease: 'none',
      duration: 60,
      repeat: -1,
      modifiers: {
        x: gsap.utils.unitize((x) => parseFloat(x) % savingCarousel.value.scrollWidth),
      },
    })
  })
})

function getBankImage(bankName) {
  const entry = Object.entries(bankImages).find(([path, _]) => path.includes(`/${bankName}.`))
  return entry ? entry[1] : null
}
</script>

<style scoped>
* {
  font-family: Pretendard;
}
html,
body {
  scroll-behavior: smooth;
  margin: 0;
  padding: 0;
  background: #f9fafb;

  /* box-shadow: inset 0 0 3px dodgerblue; */
}

.section {
  min-height: 100vh;
  /* padding: 6rem 2rem; */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  scroll-snap-align: start;
  /* padding: 200px; */
  /* box-shadow: inset 0 0 3px dodgerblue; */
}
.section.products {
  flex-direction: column;
  box-sizing: border-box;
  /* padding: none !important; */
}

.section.recommend {
  font-size: 2rem;
  font-weight: 600;
}

.section.recommend p {
  font-size: 1.5rem;
  font-weight: 500;
}
.hero {
  /* ê¸°ì¡´ ë°°ê²½ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê³  */
  position: relative;
  background:
    linear-gradient(to bottom, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.3)),
    url('@/assets/images/image10.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  text-align: center;
  color: white;
}

.hero::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 100%;
  height: 200px;
  background: linear-gradient(to bottom, transparent, #ffffff);
  z-index: 1;
}

.hero-title {
  display: block;
  word-break: keep-all;
  white-space: normal;
  text-align: center;
  font-weight: 600;
  font-size: 4rem;
  /* color: #191f28; */
}
.hero-subtitle {
  font-size: 2rem;
  /* color: #4e5968; */
}

.products {
  display: flex;
  flex-direction: row;
  background: #fff;
}
.products-text {
  font-size: 2rem;
  font-weight: 600;
  flex-direction: column;
  word-break: keep-all;
  white-space: normal;
  text-align: center;
}
.products-text p {
  font-size: 1.5rem;
  margin-top: 10px;
  font-weight: 500;
  word-break: keep-all;
  white-space: normal;
}

.recommend {
  display: flex;
  flex-direction: column;
  background: #bae6fd;
  word-break: keep-all;
  white-space: normal;
}
.community {
  background: #d1fae5;
  word-break: keep-all;
  white-space: normal;
}
.market {
  background: #f3e8ff;
  word-break: keep-all;
  white-space: normal;
}
.map {
  background: #fff7ed;
  word-break: keep-all;
  white-space: normal;
}
.bankimage {
  background-color: white;
}

.final-cta {
  background-color: #2563eb;
  color: white;
  text-align: center;
}

.cards.products {
  display: flex;
  flex-wrap: wrap;
  gap: 2rem;
  justify-content: center;
  margin-top: 2rem;
}
.card,
.graph,
.map-container {
  background-color: #e5e7eb;
  padding: 2rem;
  border-radius: 0.75rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transition: transform 0.3s ease;
}

.cta,
.cta-buttons button {
  margin-top: 2rem;
  padding: 0.8rem 1.8rem;
  background-color: #2563eb;
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s ease;
}
.cta:hover,
.cta-buttons button:hover {
  background-color: #1e40af;
}

.cta-buttons {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 1.5rem;
}

.tags {
  display: flex;
  gap: 1rem;
  margin-top: 1rem;
  flex-wrap: wrap;
}
.tags span {
  background: white;
  padding: 0.4rem 1rem;
  border-radius: 9999px;
  font-size: 0.9rem;
  font-weight: 500;
  color: #2563eb;
}

.community-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  flex-wrap: wrap;
  justify-content: flex-start;
}

.community-card {
  width: 280px;
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
  background-color: #ffffff;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 1.2rem;
  font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
}

.community-title {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
  line-height: 1.4;
  margin-bottom: 0.8rem;
}

.community-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.3rem;
  font-size: 0.75rem;
  color: #9ca3af;
  margin-bottom: 1rem;
}

.community-tag {
  background-color: #f3f4f6;
  padding: 0.2rem 0.6rem;
  border-radius: 9999px;
}

.community-extra {
  font-size: 0.85rem;
  line-height: 1.4;
  color: #374151;
  background-color: #f9fafb;
  padding: 0.8rem;
  border-radius: 12px;
  margin-top: auto;
}

.cards-section {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  margin-top: 2rem;
  width: 100%;
  align-items: center;
}

.cards-row {
  display: flex;
  gap: 2rem;
  justify-content: center;
  flex-wrap: wrap;
}

.card {
  flex: 0 0 calc(33.33% - 2rem);
  max-width: 300px;
}
.carousel-row-wrapper {
  width: 100%;
  overflow: hidden;
  position: relative;
  padding: 2rem 0;
  background-color: #fff;
}

.carousel-row-track {
  display: flex;
  gap: 2.5rem;
  width: max-content;
  flex-wrap: nowrap;
}

.carousel-card {
  width: 250px;
  height: 250px; /* ê³ ì • ë†’ì´ */
  background-color: #e5e7eb;
  border-radius: 0.75rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  flex-shrink: 0;
  word-break: keep-all;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  white-space: normal;
}

.carousel-card-header {
  flex: 0 0 40%; /* ë†’ì´ì˜ 45% */
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: white;
}

.carousel-card-header img {
  max-height: 100px;
  max-width: 100%;
  object-fit: cover;
  padding: 1rem;
}

.carousel-card-content {
  flex: 1; /* ë‚˜ë¨¸ì§€ 55% */
  padding: 1rem;
  text-align: center;
  display: flex;
  gap: 5px;
  flex-direction: column;
  justify-content: center;
  /* align-self: center; */
  font-size: 0.95rem;
}

.carousel-card-content h3 {
  font-size: 1.1rem;
  font-weight: 500;
}
.carousel-card-content h4 {
  font-size: 1rem;
  font-weight: 400;
}
.carousel-card-content h5 {
  font-size: 0.8rem;
  font-color: #4e5968;
  font-weight: 400;
}

.carousel-row-title {
  text-align: center;
  font-size: 1.5rem;
  font-weight: 500;
  margin-bottom: 60px;
}
.gradient-overlay {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 100px; /* ë” ë„“ê²Œ */
  z-index: 999;
  pointer-events: none;
}

.gradient-overlay-left {
  left: 0;
  background: linear-gradient(to right, #ffffff, rgba(255, 255, 255, 0));
}

.gradient-overlay-right {
  right: 0;
  background: linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0));
}
</style>
